.include "../Makefile.inc"

.PATH:	${GCCDIR}/libobjc ${GCCDIR}/libobjc/objc ${GCCDIR}/gcc

CFLAGS+=	-I${GCCDIR}/libobjc/objc -I. -DIN_TARGET_LIBS

LIB=		objc
SHLIB_MAJOR=	2

CSTD?=	gnu89

OBJC_THREAD_FILE=thr-objc
SRCS= \
	  archive.c class.c encoding.c gc.c hash.c init.c linking.m \
	  misc.c nil_method.c NXConstStr.m Object.m objects.c \
	  Protocol.m sarray.c selector.c sendmsg.c thr.c \
	  $(OBJC_THREAD_FILE).c exception.c

INCS= \
	 hash.h objc-list.h sarray.h objc.h objc-api.h \
	 NXConstStr.h Object.h Protocol.h encoding.h typedstream.h \
	 thr.h objc-decls.h
INCSDIR=	${INCLUDEDIR}/objc


SRCS+=	unwind.h runtime-info.h

unwind.h: unwind-generic.h
	cp ${.ALLSRC} ${.TARGET}

runtime-info.h: 
	echo "" > tmp-runtime.m
	echo "/* This file is automatically generated */" > ${.TARGET}
	${CC} -print-objc-runtime-info -S tmp-runtime.m >> ${.TARGET}
	rm -f tmp-runtime.m tmp-runtime.s

CLEANFILES+=	unwind.h runtime-info.h

.include <bsd.lib.mk>
